/**
 * Traveling Salesman Problem (TSP)
 *
 * Solution optimale : 1-3-6-2-5-4-1 (dist=20)
 *
 * Author : Olivier Grunder
 * 
 */
/* parameters */
param n ;

set I := (1..n) ;

param d{i in I, j in I};

/* Decision variables */
var x {i in I, j in I} binary ;

/* Subtour Elimination Constraint MTZ : ui = order of visit of town i */
var u{i in I }, integer, >=1, <=n ;

/* Objective function */
minimize z: sum{i in I, j in I : i!=j} d[i,j]*x[i,j] ;

/* Constraints */
s.t. totown{j in I}   : sum{i in I : i!=j} x[i,j] = 1 ;
s.t. fromtown{i in I} : sum{j in I : i!=j} x[i,j] = 1 ;

/* Subtour Elimination Constraint MTZ */
s.t. tour1 : u[1] = 1 ;
s.t. tour{i in I, j in I : i>=1 and j>=2 and i!=j} : u[i]-u[j]+n*x[i,j] <= n-1 ; 

solve ; 

display u ;

printf {i in I, j in I : x[i,j]>0} "de ville a ville : x[%d ,%d]=%d\n", i, j, x[i,j] ;

printf "-----\n" ;
printf "Tour= " ;
for {visitOrder in 1..n }
{
	printf {i in I : u[i]==visitOrder} "%d ", i-1 ;
}
printf "\n" ;
printf "dist.tot=%f\n",z;
printf "-----\n" ;

/** Data section */
data;

param n := 20 ;

param d : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 :=
1       -1.000 666.108 281.114 395.601 291.204 326.267 640.800 426.878 600.187 561.471 1040.973 655.019 975.000 1120.770 299.040 260.048 429.535 161.555 305.000 210.060       
2       666.108 -1.000 649.327 1047.091 945.145 978.085 45.000 956.151 1134.956 1132.983 1638.788 1258.590 1440.078 1515.726 957.823 724.034 494.773 595.483 843.401 564.469   
3       281.114 649.327 -1.000 603.511 508.945 542.517 610.574 308.058 485.644 487.263 1266.689 891.361 1247.758 1399.732 504.876 537.401 217.313 134.629 207.002 440.965      
4       395.601 1047.091 603.511 -1.000 104.403 69.642 1026.365 525.000 611.003 533.901 663.193 294.364 711.073 897.009 100.125 384.220 800.250 532.353 474.684 500.625        
5       291.204 945.145 508.945 104.403 -1.000 35.355 923.594 470.558 583.631 513.469 760.805 382.426 769.042 944.312 25.000 309.233 700.071 430.465 400.780 406.602
6       326.267 978.085 542.517 69.642 35.355 -1.000 957.040 491.554 596.008 523.259 726.103 349.285 744.194 922.781 40.311 328.824 735.017 465.672 427.931 435.230
7       640.800 45.000 610.574 1026.365 923.594 957.040 -1.000 918.096 1095.924 1095.730 1627.421 1245.201 1440.312 1521.726 935.361 713.863 451.248 562.250 807.001 551.770   
8       426.878 956.151 308.058 525.000 470.558 491.554 918.096 -1.000 183.439 180.347 1144.902 812.050 1234.342 1414.231 452.548 660.984 506.582 381.215 125.897 635.964      
9       600.187 1134.956 485.644 611.003 583.631 596.008 1095.924 183.439 -1.000 83.217 1165.611 873.856 1316.757 1507.116 561.471 817.955 670.317 564.646 308.058 810.247     
10      561.471 1132.983 487.263 533.901 513.469 523.259 1095.730 180.347 83.217 -1.000 1082.647 792.086 1236.578 1428.294 490.433 763.692 686.477 547.951 290.904 770.276     
11      1040.973 1638.788 1266.689 663.193 760.805 726.103 1627.421 1144.902 1165.611 1082.647 -1.000 387.072 442.719 619.556 762.365 914.822 1460.693 1190.095 1124.300 1075.663
12      655.019 1258.590 891.361 294.364 382.426 349.285 1245.201 812.050 873.856 792.086 387.072 -1.000 452.134 653.242 388.104 537.703 1078.355 806.877 768.847 694.136      
13      975.000 1440.078 1247.758 711.073 769.042 744.194 1440.312 1234.342 1316.757 1236.578 442.719 452.134 -1.000 205.548 784.092 759.276 1399.509 1136.541 1169.466 919.918
14      1120.770 1515.726 1399.732 897.009 944.312 922.781 1521.726 1414.231 1507.116 1428.294 619.556 653.242 205.548 -1.000 961.691 883.883 1534.218 1280.674 1340.634 1034.650
15      299.040 957.823 504.876 100.125 25.000 40.311 935.361 452.548 561.471 490.433 762.365 388.104 784.092 961.691 -1.000 332.415 700.161 432.348 387.621 424.794
16      260.048 724.034 537.401 384.220 309.233 328.824 713.863 660.984 817.955 763.692 914.822 537.703 759.276 883.883 332.415 -1.000 650.711 407.830 548.862 165.076
17      429.535 494.773 217.313 800.250 700.071 735.017 451.248 506.582 670.317 686.477 1460.693 1078.355 1399.509 1534.218 700.161 650.711 -1.000 271.662 421.100 512.079     
18      161.555 595.483 134.629 532.353 430.465 465.672 562.250 381.215 564.646 547.951 1190.095 806.877 1136.541 1280.674 432.348 407.830 271.662 -1.000 258.118 306.472      
19      305.000 843.401 207.002 474.684 400.780 427.931 807.001 125.897 308.058 290.904 1124.300 768.847 1169.466 1340.634 387.621 548.862 421.100 258.118 -1.000 512.445      
20      210.060 564.469 440.965 500.625 406.602 435.230 551.770 635.964 810.247 770.276 1075.663 694.136 919.918 1034.650 424.794 165.076 512.079 306.472 512.445 -1.000
;

end ;

